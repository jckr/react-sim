{"version":3,"sources":["webpack:///./node_modules/gatsby/node_modules/core-js/modules/es6.math.hypot.js","webpack:///./src/components/examples/epidemic.js","webpack:///./src/pages/examples/epidemic.mdx"],"names":["$export","abs","Math","S","hypot","value1","value2","arg","div","sum","i","aLen","arguments","length","larg","Infinity","sqrt","COLORS","sick","recovered","healthy","dead","updateEpidemic","data","tick","params","complete","updatedData","JSON","parse","stringify","agents","nbSick","nbHealthy","nbDead","nbRecovered","contaminationRisk","deathRisk","r","recoveryTicks","height","width","forEach","agent","status","recovery","random","j","otherAgent","dx","x","dy","y","distance","ax","ay","vx","vy","chooseMamongN","n","m","N","Array","keys","reduce","prev","curr","results","Set","k","floor","Object","add","findOverlaps","point","x0","y0","slice","filter","initData","nbAgents","maxSpeed","nbDistancing","distancing","has","isDistancing","speed","push","isBouncing","EpidemicFrame","props","myRef","React","createRef","componentDidUpdate","this","ctx","current","getContext","fillStyle","lineWidth","clearRect","beginPath","arc","PI","closePath","fill","render","ref","Component","ConnectedFrame","withFrame","series","color","label","accessor","d","Epidemic","auto","initialParams","updateData","maxTime","flexDirection","stacked","_frontmatter","layoutProps","MDXContent","components","mdxType","isMDXComponent"],"mappings":"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","file":"component---src-pages-examples-epidemic-mdx-882f742c061494d91dee.js","sourcesContent":["// 20.2.2.17 Math.hypot([value1[, value2[, â€¦ ]]])\nvar $export = require('./_export');\nvar abs = Math.abs;\n\n$export($export.S, 'Math', {\n  hypot: function hypot(value1, value2) { // eslint-disable-line no-unused-vars\n    var sum = 0;\n    var i = 0;\n    var aLen = arguments.length;\n    var larg = 0;\n    var arg, div;\n    while (i < aLen) {\n      arg = abs(arguments[i++]);\n      if (larg < arg) {\n        div = larg / arg;\n        sum = sum * div * div + 1;\n        larg = arg;\n      } else if (arg > 0) {\n        div = arg / larg;\n        sum += div * div;\n      } else sum += arg;\n    }\n    return larg === Infinity ? Infinity : larg * Math.sqrt(sum);\n  }\n});\n","import React, { useRef, useEffect } from 'react';\nimport { Flex } from 'rebass';\nimport { Model, TimeSeries, Counter, withFrame } from 'react-sim';\n\nconst COLORS = {\n  sick: '#4f8c9d',\n  recovered: '#add51f',\n  healthy: '#997cfb',\n  dead: '#6a9012',\n};\n\nexport function updateEpidemic({ data, tick, params, complete }) {\n  let updatedData = JSON.parse(JSON.stringify(data.agents));\n  let nbSick = 0,\n    nbHealthy = 0,\n    nbDead = 0,\n    nbRecovered = 0;\n\n  const {\n    contaminationRisk,\n    deathRisk,\n    r,\n    recoveryTicks,\n    height,\n    width,\n  } = params;\n\n  updatedData.forEach((agent, i) => {\n    // update status\n\n    if (agent.status === 'sick') {\n      if (tick >= agent.recovery) {\n        agent.status = 'recovered';\n      } else {\n        if (Math.random() < deathRisk) {\n          agent.status = 'dead';\n        }\n      }\n    }\n    if (agent.status !== 'dead') {\n      // checking for collisions\n\n      for (let j = i + 1; j < updatedData.length; j++) {\n        let otherAgent = updatedData[j];\n        const dx = otherAgent.x - agent.x;\n        const dy = otherAgent.y - agent.y;\n        const distance = Math.hypot(dx, dy);\n        if (distance < 2 * r) {\n          // collision\n\n          const ax = dx / distance;\n          const ay = dy / distance;\n\n          agent.vx = agent.vx - ax;\n          agent.vy = agent.vy - ay;\n          otherAgent.vx = ax;\n          otherAgent.vy = ay;\n\n          // test for contagion\n\n          if (agent.status === 'sick' && otherAgent.status === 'healthy') {\n            if (Math.random() <= contaminationRisk) {\n              otherAgent.status = 'sick';\n              otherAgent.recovery = tick + recoveryTicks;\n            }\n          }\n          if (agent.status === 'healthy' && otherAgent.status === 'sick') {\n            if (Math.random() <= contaminationRisk) {\n              agent.status = 'sick';\n              agent.recovery = tick + recoveryTicks;\n            }\n          }\n        }\n      }\n\n      // now move\n\n      agent.x = agent.x + agent.vx;\n      agent.y = agent.y + agent.vy;\n\n      // bouncing on walls\n      if (\n        (agent.vy < 0 && agent.y < r) ||\n        (agent.vy > 0 && agent.y > height - r)\n      ) {\n        agent.vy = -agent.vy;\n      }\n\n      if (\n        (agent.vx < 0 && agent.x < r) ||\n        (agent.vx > 0 && agent.x > width - r)\n      ) {\n        agent.vx = -agent.vx;\n      }\n    }\n    // counting agents\n    switch (agent.status) {\n      case 'sick':\n        nbSick++;\n        break;\n      case 'healthy':\n        nbHealthy++;\n        break;\n      case 'recovered':\n        nbRecovered++;\n        break;\n      case 'dead':\n        nbDead++;\n    }\n  });\n  if (nbSick === 0) {\n    complete();\n  }\n\n  return {\n    agents: updatedData,\n    sick: nbSick,\n    recovered: nbRecovered,\n    dead: nbDead,\n    healthy: nbHealthy,\n  };\n}\n\nfunction chooseMamongN(n, m) {\n  const N = [...Array(n).keys()].reduce((prev, curr) => {\n    prev[curr] = true;\n    return prev;\n  }, {});\n  const results = new Set();\n\n  for (let i = 0; i < m; i++) {\n    const k = Math.floor(Math.random() * Object.keys(N).length);\n    results.add(k);\n    delete N[k];\n  }\n\n  return results;\n}\n\nfunction findOverlaps(agents, i, r, point) {\n  const { x: x0, y: y0 } = point;\n  const domain = agents.slice(i);\n  return domain.filter(({ x, y }) => Math.hypot(x - x0, y - y0) < r);\n}\n\nfunction initData({\n  nbAgents = 200,\n  nbSick = 5,\n  maxSpeed = 30,\n  contaminationRisk = 1,\n  deathRisk = 0.005,\n  recoveryTicks = 20,\n  nbDistancing = 50,\n  r = 3,\n  height = 300,\n  width = 400,\n}) {\n  const sick = chooseMamongN(nbAgents, nbSick);\n  const distancing = chooseMamongN(nbAgents, nbDistancing);\n  const agents = [];\n\n  for (let i = 0; i < nbAgents; i++) {\n    let x, y;\n\n    do {\n      y = r / 2 + Math.random() * (height - r);\n      x = r / 2 + Math.random() * (width - r);\n    } while (findOverlaps(agents, 0, r, { x, y }).length);\n\n    const status = sick.has(i) ? 'sick' : 'healthy';\n\n    const recovery = sick.has(i) ? recoveryTicks : null;\n    const isDistancing = distancing.has(i);\n    const speed = isDistancing ? 0 : maxSpeed;\n    const vx = speed * (Math.random() * 2 - 1);\n    const vy = speed * (Math.random() * 2 - 1);\n    const isBouncing = false;\n\n    agents.push({\n      x,\n      y,\n      status,\n      isBouncing,\n      isDistancing,\n      vx,\n      vy,\n      recovery,\n      speed,\n    });\n  }\n  return {\n    agents,\n    sick: nbSick,\n    healthy: nbAgents - nbSick,\n    dead: 0,\n    recovered: 0,\n  };\n}\n\nexport class EpidemicFrame extends React.Component {\n  constructor(props) {\n    super(props);\n    this.myRef = React.createRef();\n  }\n  componentDidUpdate() {\n    const {\n      data,\n      params: { width, height, r },\n    } = this.props;\n    const canvas = this.myRef.current;\n    const ctx = canvas.getContext('2d');\n    ctx.fillStyle = '#fff';\n    ctx.lineWidth = '5px';\n    ctx.clearRect(0, 0, width, height);\n    data.agents.forEach(({ status, isBouncing, x, y }) => {\n      ctx.beginPath();\n      ctx.fillStyle = COLORS[status];\n      ctx.arc(x, y, r, 0, 2 * Math.PI, false);\n      ctx.closePath();\n      ctx.fill();\n    });\n  }\n  render() {\n    return (\n      <div>\n        <canvas\n          width={this.props.params.width}\n          height={this.props.params.height}\n          ref={this.myRef}\n        />\n      </div>\n    );\n  }\n}\n\nconst ConnectedFrame = withFrame(EpidemicFrame);\n\nconst series = [\n  {\n    color: COLORS['healthy'],\n    label: 'Healthy',\n    accessor: d => d.healthy,\n  },\n  {\n    color: COLORS['sick'],\n    label: 'Sick',\n    accessor: d => d.sick,\n  },\n  {\n    color: COLORS['recovered'],\n    label: 'Recovered',\n    accessor: d => d.recovered,\n  },\n  {\n    color: COLORS['dead'],\n    label: 'Dead',\n    accessor: d => d.dead,\n  },\n];\n\nconst Epidemic = () => (\n  <Model\n    auto=\"false\"\n    initData={initData}\n    initialParams={{\n      nbAgents: 500,\n      nbSick: 20,\n      contaminationRisk: 1,\n      deathRisk: 0.001,\n      maxSpeed: 2,\n      recoveryTicks: 200,\n      nbDistancing: 0,\n      r: 3,\n      height: 300,\n      width: 500,\n    }}\n    updateData={updateEpidemic}\n    maxTime={500}\n  >\n    <Flex flexDirection=\"column\">\n      <ConnectedFrame />\n      <TimeSeries series={series} stacked={true}/>\n      <Counter series={series} />\n    </Flex>\n  </Model>\n);\n\nexport default Epidemic;\n","import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport Epidemic from '../../components/examples/epidemic';\nexport const _frontmatter = {\n  \"Title\": \"Epidemic\"\n};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = \"wrapper\";\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1>{`Epidemic`}</h1>\n    <Epidemic mdxType=\"Epidemic\" />\n    <h3>{`Caveat`}</h3>\n    <p>{`The purpose of this model is just to show how simulations work in React. It has no scientific value.`}</p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}